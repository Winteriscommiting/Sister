<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Card Garden — Memory Match</title>
  <style>
    :root { --accent:#ff00ff; --cyan:#00ffff; --gold:#ffd700; --bg1:#0b0213; --bg2:#1c0134; }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: radial-gradient(1100px 600px at 50% 25%, var(--bg2), var(--bg1) 60%, #000 100%); color:#fff}

    .wrap{min-height:100%;display:grid;grid-template-rows:auto 1fr auto}
    header{display:flex;gap:12px;align-items:center;justify-content:center;padding:14px;position:sticky;top:0;z-index:5}
    .pill{padding:6px 12px;border-radius:999px;background:rgba(0,0,0,.35);border:1px solid rgba(255,255,255,.2);backdrop-filter:blur(6px);font-weight:800;text-shadow:0 2px 8px rgba(0,0,0,.6)}
  .spacer{flex:1}
  .actions{display:flex;gap:8px}
    .grid{display:grid;place-content:center;padding:20px;gap:12px;grid-template-columns:repeat(6, minmax(60px, 110px))}
    .card{width:100%;aspect-ratio:3/4;position:relative;transform-style:preserve-3d;transition:transform .42s cubic-bezier(.2,.8,.2,1);cursor:pointer}
    .face{position:absolute;inset:0;border-radius:14px;display:grid;place-items:center;font-size:clamp(22px, 5vw, 40px);backface-visibility:hidden}
    .front{background:linear-gradient(145deg, rgba(255,255,255,.06), rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.2);box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .back{transform:rotateY(180deg);background:radial-gradient(60% 60% at 40% 30%, rgba(255,255,255,.88), rgba(255,255,255,.22));border:1px solid rgba(255,255,255,.3);box-shadow:0 10px 30px rgba(0,0,0,.45);color:#000}
    .card.flipped{transform:rotateY(180deg)}
    .card.matched .back{box-shadow:0 0 24px var(--accent), 0 0 50px rgba(255,0,255,.4)}

    .bar{display:flex;justify-content:center;gap:12px;padding:14px}
    .btn{padding:12px 16px;border-radius:999px;border:2px solid var(--accent);background:linear-gradient(45deg, rgba(255,0,255,.2), rgba(0,255,255,.2));color:#fff;font-weight:800;letter-spacing:.04em;cursor:pointer;-webkit-user-select:none;user-select:none;box-shadow:0 0 30px rgba(255,0,255,.35), inset 0 0 18px rgba(255,255,255,.15)}
  .btnSmall{padding:8px 12px;font-size:12px}

    /* Modal */
    .modal{position:fixed;inset:0;display:grid;place-items:center;background:rgba(0,0,0,.45);z-index:25}
    .panel{max-width:520px;margin:0 24px;padding:28px;border-radius:20px;background:rgba(255,255,255,.06);border:2px solid rgba(255,255,255,.28);backdrop-filter:blur(18px);box-shadow:0 24px 60px rgba(0,0,0,.55)}
    .panel h3{margin:0 0 12px;font-size:22px}
    .field{display:flex;gap:10px}
    .field input{flex:1;min-width:0;padding:12px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.28);background:rgba(0,0,0,.35);color:#fff;outline:none;-webkit-user-select:text;user-select:text}

    /* Celebration overlay */
    #celebrate{position:fixed;inset:0;display:none;place-items:center;background:radial-gradient(circle at 50% 40%, #3a0050 0%, #12001a 55%, #000 100%);z-index:20;overflow:hidden}
    #card{max-width:1000px;margin:0 24px;padding:48px;border-radius:28px;background:rgba(255,255,255,.06);border:2px solid rgba(255,255,255,.28);backdrop-filter:blur(26px);box-shadow:0 30px 80px rgba(0,0,0,.6), inset 0 0 40px rgba(255,255,255,.06);animation:float 4.2s ease-in-out infinite}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-12px)}}
    .title{font-size:clamp(40px,7vw,90px);font-weight:900;letter-spacing:.04em;text-align:center;margin-bottom:10px;background:linear-gradient(45deg,var(--gold),#fff,var(--gold));background-size:200% 200%;-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;animation:shine 3s ease-in-out infinite;text-shadow:0 0 30px rgba(255,215,0,.5)}
    @keyframes shine{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
    .msg{font-size:clamp(16px,2.2vw,28px);text-align:center;line-height:1.8;text-shadow:0 2px 8px rgba(0,0,0,.5)}
    .sig{font-size:clamp(18px,2.4vw,32px);font-weight:800;color:#ffe4e6;text-align:center;margin-top:20px;text-shadow:0 0 20px rgba(255,228,230,.8)}
    .emoji{font-size:clamp(64px,10vw,120px);text-align:center;filter:drop-shadow(0 0 14px rgba(255,215,0,.8))}

  .fw{position:fixed;width:4px;height:4px;background:currentColor;border-radius:50%;box-shadow:0 0 12px 3px currentColor;animation:fw 1.05s ease-out forwards;z-index:30}
  @keyframes fw{0%{transform:translate(0,0);opacity:1}100%{transform:translate(var(--tx),var(--ty));opacity:0}}
  .hidden{display:none!important}
  /* Mid-game surprise overlay */
  #midWish.modal{background:rgba(0,0,0,.55)}
  .midTitle{font-size:clamp(22px,4vw,36px);font-weight:800;margin:0 0 8px;text-align:center}
  .midMsg{font-size:clamp(14px,2vw,20px);text-align:center;opacity:.95}
  /* Persistent surprise layer */
  #surprise{position:fixed;inset:0;display:none;pointer-events:none;z-index:15}
  #surprise .hbTitle{position:absolute;top:6%;left:50%;transform:translateX(-50%);font-size:clamp(32px,7vw,88px);font-weight:900;letter-spacing:.04em;text-align:center;background:linear-gradient(45deg,var(--gold),#fff,var(--gold));background-size:200% 200%;-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent;animation:shine 3.2s ease-in-out infinite;text-shadow:0 0 30px rgba(255,215,0,.5)}
  #surprise .wishLong{position:absolute;top:calc(6% + clamp(40px,7vw,90px));left:50%;transform:translateX(-50%);max-width:min(900px,92vw);padding:8px 12px;text-align:center;font-size:clamp(14px,2.2vw,22px);opacity:.95;text-shadow:0 2px 8px rgba(0,0,0,.6)}
  #surprise .cake{position:fixed;left:50%;bottom:16px;transform:translateX(-50%);width:min(360px,80vw);height:160px}
  .cake .plate{position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:100%;height:16px;background:linear-gradient(180deg,#bbb,#888);border-radius:10px}
  .cake .layer{position:absolute;left:50%;transform:translateX(-50%);width:90%;height:46px;border-radius:10px;box-shadow:0 8px 20px rgba(0,0,0,.3)}
  .cake .layer.top{bottom:100px;background:linear-gradient(180deg,#ffe4ec,#ffb3c7)}
  .cake .layer.mid{bottom:58px;background:linear-gradient(180deg,#fff2b3,#ffd36b)}
  .cake .layer.bot{bottom:16px;background:linear-gradient(180deg,#c9f7ff,#72e4ff)}
  .cake .drip{position:absolute;width:14px;height:18px;background:rgba(255,255,255,.9);border-radius:8px}
  .cake .d1{left:22%}
  .cake .d2{left:58%}
  .cake .candles{position:absolute;bottom:136px;left:50%;transform:translateX(-50%);display:flex;gap:10px}
  .cake .candle{width:10px;height:28px;background:#fff;border-radius:4px;position:relative}
  .cake .flame{position:absolute;top:-12px;left:50%;transform:translateX(-50%);width:10px;height:14px;border-radius:10px;background:radial-gradient(circle,#ffd700 0%, #ff7b00 70%, transparent 71%);filter:drop-shadow(0 0 10px rgba(255,200,0,.9));animation:flicker .8s ease-in-out infinite}
  @keyframes flicker{0%,100%{transform:translateX(-50%) scale(1)}50%{transform:translateX(-50%) scale(1.2)}}
  #rockets, #floaters{position:absolute;inset:0;overflow:hidden}
  .rocket{position:absolute;font-size:28px;filter:drop-shadow(0 0 8px rgba(255,255,255,.8))}
  .flyR{animation:flyR 5.5s linear forwards}
  .flyL{animation:flyL 5.5s linear forwards}
  @keyframes flyR{0%{transform:translateX(-80px) rotate(20deg)}100%{transform:translateX(calc(100vw + 80px)) rotate(20deg)}}
  @keyframes flyL{0%{transform:translateX(calc(100vw + 80px)) rotate(-20deg)}100%{transform:translateX(-80px) rotate(-20deg)}}
  .floater{position:absolute;font-weight:900;font-size:clamp(16px,3vw,28px);text-shadow:0 4px 12px rgba(0,0,0,.6);animation:floatUp 6s ease-in forwards}
  @keyframes floatUp{0%{transform:translateY(40px);opacity:.0}20%{opacity:1}100%{transform:translateY(-220px);opacity:0}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="pill">Moves: <span id="moves">0</span></div>
      <div class="pill">Time: <span id="time">0</span>s</div>
      <div class="pill">Player: <span id="player">—</span></div>
      <div class="spacer"></div>
      <div class="actions">
        <button id="changeName" class="btn btnSmall" type="button">Change name</button>
      </div>
    </header>

    <main class="grid" id="grid"></main>

    <div class="bar">
      <button class="btn" id="startBtn">Start Game</button>
      <button class="btn" id="resetBtn">Reset</button>
    </div>
  </div>

  <!-- Persistent Surprise Layer (stays visible) -->
  <div id="surprise">
    <div id="rockets"></div>
    <div id="floaters"></div>
    <div class="hbTitle">HAPPY BIRTHDAY <span id="surpriseName"></span>!</div>
    <div class="wishLong">Wishing you a day that sparkles, a year that glows, and a lifetime that shines. May your journey be filled with kind people, fearless choices, unexpected victories, warm sunsets, long chats, cozy rain, and the courage to dream bigger every time. You’re loved more than words — today and always. ✨</div>
    <div class="cake">
      <div class="plate"></div>
  <div class="layer top"><span class="drip d1"></span><span class="drip d2"></span></div>
      <div class="layer mid"></div>
      <div class="layer bot"></div>
      <div class="candles">
        <div class="candle"><div class="flame"></div></div>
        <div class="candle"><div class="flame"></div></div>
        <div class="candle"><div class="flame"></div></div>
      </div>
    </div>
  </div>

  <!-- Name modal -->
  <div id="nameModal" class="modal hidden">
    <div class="panel">
      <h3>Enter player name</h3>
      <div class="field">
        <input id="nameInput" type="text" maxlength="40" placeholder="Your name" />
        <button id="nameSave" class="btn">Continue</button>
      </div>
    </div>
  </div>

  <!-- Celebration -->
  <div id="celebrate">
    <div id="card">
      <div class="emoji">🎁🎉</div>
      <div class="title">HAPPY BIRTHDAY <span id="who"></span>!</div>
      <div class="msg">Memory master! You found all pairs — what a champion! ✨ May your year be packed with laughter, dream-chasing energy, cozy chai, scenic drives, new adventures, and endless smiles. You’ve got this, today and every day. Keep shining, Superstar! 🌟</div>
      <div class="sig">From thambi..! 🫷</div>
    </div>
  </div>

  <!-- Mid‑game surprise -->
  <div id="midWish" class="modal hidden">
    <div class="panel">
      <div class="emoji">🎊💖</div>
      <h3 class="midTitle">A tiny surprise for <span id="midWho"></span>…</h3>
      <div class="midMsg">Happy Birthday! You’re doing amazing — take a breath, soak in the joy, and keep going… the best is yet to come! 🎉</div>
    </div>
  </div>

  <script>
    const grid = document.getElementById('grid');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const movesEl = document.getElementById('moves');
    const timeEl = document.getElementById('time');
    const playerEl = document.getElementById('player');
    const nameModal = document.getElementById('nameModal');
    const nameInput = document.getElementById('nameInput');
    const nameSave = document.getElementById('nameSave');
    const celebrate = document.getElementById('celebrate');
    const whoEl = document.getElementById('who');
  const changeNameBtn = document.getElementById('changeName');
    const surprise = document.getElementById('surprise');
    const surpriseName = document.getElementById('surpriseName');
    const rocketsEl = document.getElementById('rockets');
    const floatersEl = document.getElementById('floaters');
  const midWish = document.getElementById('midWish');
  const midWho = document.getElementById('midWho');

    const ICONS = ['💎','⭐','🍬','🌸','🧁','❤️','🎈','🍫','🪄','🌟','🍰','🎀'];
    const COLS = 6, ROWS = 4; // 12 pairs => 24 cards

    let cards = []; // [{icon, id, matched, el}]
    let first = null, second = null;
  let moves = 0; let running = false; let startTime = 0; let timerId = null;
  let midTimer = null; let midShown = false; let elapsedBeforePause = 0;
  let surpriseShown = false; let rocketTimer=null; let floaterTimer=null; let confettiTimer=null;
    let playerName = '';

    function samplePairs(){
      const needed = (COLS*ROWS)/2; const pool = [...ICONS];
      const picked = [];
      for (let i=0;i<needed;i++) picked.push(pool.splice((Math.random()*pool.length)|0,1)[0]);
      const arr = picked.flatMap((ic,idx)=> [{icon:ic,id:idx+'a'},{icon:ic,id:idx+'b'}]);
      arr.sort(()=>Math.random()-0.5);
      return arr;
    }

    function createCard(card){
      const el = document.createElement('div'); el.className = 'card'; el.dataset.id = card.id;
      const front = document.createElement('div'); front.className='face front'; front.textContent='';
      const back = document.createElement('div'); back.className='face back'; back.textContent=card.icon;
      el.appendChild(front); el.appendChild(back);
      el.addEventListener('click', () => onFlip(el, card));
      card.el = el; return el;
    }

    function renderBoard(){
      grid.innerHTML='';
      cards = samplePairs();
      cards.forEach(c => grid.appendChild(createCard(c)));
    }

    function onFlip(el, card){
      if (!running || card.matched || el.classList.contains('flipped')) return;
      el.classList.add('flipped');
      if (!first) { first = card; return; }
      if (first === card) return;
      second = card; moves++; movesEl.textContent = moves;
      // Evaluate
      if (first.icon === second.icon) {
        first.matched = second.matched = true;
        first.el.classList.add('matched'); second.el.classList.add('matched');
        confettiBurst(centerOf(first.el)); confettiBurst(centerOf(second.el));
        maybeShowSurprise();
        first = second = null; checkWin();
      } else {
        const a = first.el, b = second.el; first = second = null;
        setTimeout(()=>{ a.classList.remove('flipped'); b.classList.remove('flipped'); }, 700);
      }
    }

    function centerOf(el){ const r = el.getBoundingClientRect(); return { x: r.left + r.width/2, y: r.top + r.height/2 }; }
    function confettiBurst(p){
      for (let j=0;j<28;j++){
        const d=document.createElement('div'); d.className='fw'; d.style.left=p.x+'px'; d.style.top=p.y+'px'; d.style.color=['#ff00ff','#00ffff','#ffd700'][j%3];
        const a=(Math.PI*2*j)/28; const v=100+Math.random()*120; d.style.setProperty('--tx', Math.cos(a)*v+'px'); d.style.setProperty('--ty', Math.sin(a)*v+'px');
        document.body.appendChild(d); setTimeout(()=>d.remove(),1050);
      }
    }

    function checkWin(){
      if (cards.every(c=>c.matched)) {
        running = false; clearInterval(timerId);
        if (midTimer) { clearTimeout(midTimer); midTimer = null; }
        if (playerName) whoEl.textContent = ' ' + playerName.toUpperCase();
        celebrate.style.display='grid';
        // extra burst center
        confettiBurst({x: innerWidth*0.5, y: innerHeight*0.35});
        // database removed; no session recording
      }
    }

    function matchedPairs(){ return cards.filter(c=>c.matched).length / 2; }
    function maybeShowSurprise(){ if (!surpriseShown && matchedPairs() >= 4){ showSurprise(); } }
    function showSurprise(){
      surpriseShown = true;
      if (playerName) { surpriseName.textContent = ' ' + playerName.toUpperCase(); }
      surprise.style.display = 'block'; // persistent layer stays
      rocketTimer = setInterval(spawnRocket, 2800);
      floaterTimer = setInterval(spawnFloater, 1800);
      confettiTimer = setInterval(()=>{ confettiBurst({x: Math.random()*innerWidth, y: innerHeight*0.3 + Math.random()*innerHeight*0.4}); }, 2200);
      for (let i=0;i<2;i++){ setTimeout(spawnRocket, i*600); setTimeout(spawnFloater, i*500); }
    }
    function spawnRocket(){
      const r = document.createElement('div'); r.className='rocket'; r.textContent = Math.random()<0.5 ? '🚀' : '🧨';
      const dirRight = Math.random() < 0.5; r.classList.add(dirRight? 'flyR':'flyL');
      r.style.top = (10 + Math.random()*60) + 'vh';
      r.style.left = dirRight? '-60px' : 'calc(100vw + 60px)';
      rocketsEl.appendChild(r); r.addEventListener('animationend', ()=> r.remove());
    }
    function spawnFloater(){
      const f = document.createElement('div'); f.className='floater';
      const phrases = ['Happy Birthday','Shine On ✨','Lots of Love 💖','Celebrate 🎉','Dream Big 🌟', (playerName? ('For '+playerName) : 'To You')];
      f.textContent = phrases[(Math.random()*phrases.length)|0];
      f.style.left = (10 + Math.random()*80) + 'vw'; f.style.bottom = '5vh';
      floatersEl.appendChild(f); setTimeout(()=> f.remove(), 6500);
    }

    function startGame(){
      moves = 0; movesEl.textContent = moves; timeEl.textContent = 0; running = true; startTime = Date.now(); elapsedBeforePause = 0; midShown = false;
      clearInterval(timerId); timerId = setInterval(()=>{ timeEl.textContent = Math.floor((Date.now()-startTime)/1000); }, 250);
      scheduleMidWish();
      renderBoard();
    }

    function resetGame(){ running = false; clearInterval(timerId); if (midTimer) clearTimeout(midTimer); midShown=false; renderBoard(); movesEl.textContent = 0; timeEl.textContent = 0; first = second = null; celebrate.style.display='none'; }

    function scheduleMidWish(){ if (midTimer) clearTimeout(midTimer); const delay = 10000 + Math.random()*10000; midTimer = setTimeout(showMidWish, delay); }
    function showMidWish(){
      if (midShown || !running) return;
      midShown = true;
      // Pause timer and gameplay
      clearInterval(timerId);
      elapsedBeforePause = Date.now() - startTime;
      running = false;
      if (playerName) midWho.textContent = ' ' + playerName;
      midWish.classList.remove('hidden');
      confettiBurst({x: innerWidth*0.5, y: innerHeight*0.35});
      setTimeout(hideMidWish, 4500);
    }
    function hideMidWish(){
      midWish.classList.add('hidden');
      // Resume timer and gameplay
      startTime = Date.now() - elapsedBeforePause;
      running = true;
      clearInterval(timerId);
      timerId = setInterval(()=>{ timeEl.textContent = Math.floor((Date.now()-startTime)/1000); }, 250);
    }

    function getName(){ const p = new URLSearchParams(location.search); const n = (p.get('n')||'').trim(); if (n) return n.substring(0,40); const ls=(localStorage.getItem('playerName')||'').trim(); if (ls) return ls.substring(0,40); return ''; }
    function setName(n){
      playerName = (n||'').trim().substring(0,40);
      if (playerName){
        localStorage.setItem('playerName', playerName);
        playerEl.textContent = playerName;
        document.title = 'Card Garden — ' + playerName;
      }
    }

    // Init name: always prompt each time (prefill if known)
  (function init(){ const n = getName(); if (n){ nameInput.value = n; } nameModal.classList.remove('hidden'); nameInput.focus(); })();
    nameSave.addEventListener('click', ()=>{ const n=nameInput.value; if(!n.trim()) { nameInput.focus(); return; } nameModal.classList.add('hidden'); setName(n); });
    nameInput.addEventListener('keydown', e=>{ if (e.key==='Enter') nameSave.click(); });

    startBtn.addEventListener('click', ()=>{ if (!playerName){ nameModal.classList.remove('hidden'); nameInput.focus(); return; } startGame(); });
    resetBtn.addEventListener('click', resetGame);

  changeNameBtn.addEventListener('click', ()=>{ nameModal.classList.remove('hidden'); nameInput.value = playerName; nameInput.focus(); });
  // No welcome page; back link removed
  </script>
</body>
</html>
